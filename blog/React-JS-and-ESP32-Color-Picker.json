{"html":"<p><a href=\"https://github.com/CollingsKenny/React-JS-and-ESP32-Color-Picker\">See the code</a></p>\n<h1 id=\"introduction\">Introduction</h1>\n<p>The ESP32 is a powerful little piece of hardware that has a wide array of uses and possibilities. One major feature of the ESP32 is its ability to add wireless connectivity to almost any electronics project.</p>\n<p>React is another powerful tool. React is the industry standard for developing front end web applications. Using JavaScript, React provides a framework for developing reactive UIs.</p>\n<p>Today I will show you how to merge these two technologies, unlocking the ability to create large, fully featured web applications connected with your hardware projects. Together, we will create a web application that controls the color of the built in LED on the ESP32-S2.</p>\n<p>Note: The S2 version is not required to host a react application, it&#39;s just the one I am using and you may need to modify the IO pins to follow along with your board.</p>\n<h1 id=\"what-you-need\">What you need</h1>\n<ul>\n<li>An ESP32. I am using an ESP32-S2-DevKit available from Mouser for $8.</li>\n<li>Arduino IDE</li>\n<li>VSCode with optional Arduino extension</li>\n<li><a href=\"https://github.com/me-no-dev/arduino-esp32fs-plugin\">ESP32 FS uploader</a><ul>\n<li>If using the S2, use <a href=\"https://github.com/etherfi/arduino-esp32fs-plugin-esp32s2\">this fork</a></li>\n</ul>\n</li>\n<li>External Libraries:<ul>\n<li><a href=\"https://docs.espressif.com/projects/arduino-esp32/en/latest/installing.html\">ESP32</a></li>\n<li><a href=\"https://github.com/me-no-dev/ESPAsyncWebServer\">ESPAsyncWebServer</a></li>\n<li><a href=\"https://github.com/me-no-dev/AsyncTCP\">AsyncTCP</a></li>\n</ul>\n</li>\n<li>Arduino Libraries:<ul>\n<li>Adafruit NeoPixel</li>\n</ul>\n</li>\n<li>NodeJS</li>\n<li>Yarn</li>\n</ul>\n<p>For the sake of concision, I will not be covering the installation of these tools.</p>\n<h1 id=\"step-1---react-in-a-pack\">Step 1 - React in a Pack</h1>\n<p>Setting up the React application is, in my opinion, the most difficult piece and the key to this project. As React is simply a javascript framework there are many different ways to set up a project, and many of the most popular incarnations from the web development community are not appropriate for our use case.</p>\n<p>I will now ramble on about why we are doing this, if you don&#39;t care feel free to skip this section. In the web development world that React comes from, web applications are usually served and hosted on servers. These servers are typically in large datacenters and have access to unprecedented amounts of compute power. In this case, the device the user is connecting from is the weakest link, so much of react tooling is built with this perspective. Our perspective, however, is severely different. The device you are connecting from is incomprehensibly faster than the ESP32, and we need to make sure this is considered.</p>\n<p>Our desired outcome is to ensure that the ESP32 is doing the minimum possible work and we offload as much as possible to the &quot;user&#39;s&quot; device. We can configure the ESP32 to only serve the files and all the UI processing will happen in the user&#39;s browser. In addition, it is generally easier to work with data in Javascript as we don&#39;t have the constraints of C++ and embedded systems.</p>\n<h3 id=\"i-react-boiler\">I. React Boiler</h3>\n<p>We will bootstrap react with.... nothing! That&#39;s right we are going to create a custom react app and then bundle it together with webpack. This will allow us to use all the features of React and shove it all into a couple nice little files that we can serve from the ESP32.</p>\n<ol>\n<li> Create a new folder. This will contain the whole project.</li>\n<li> Inside the new folder, create another new folder, called app. This will contain the React portion.</li>\n<li> cd into app/. Run the command <code>yarn init -y</code></li>\n<li> <code>yarn add react react-dom</code></li>\n<li>Create two more directories, <code>src</code>, <code>public</code>.<ol>\n<li> In <code>src</code> create 2 files: <code>index.js</code>, <code>App.js</code></li>\n<li> In public create 2 files: <code>index.html</code> and an icon <code>favicon.ico</code></li>\n</ol>\n</li>\n<li> Open the app folder in VSCode with <code>code .</code></li>\n<li> Lets not populate these files with some basic React boilerplate:</li>\n</ol>\n<p>index.js:</p>\n<pre class=\"shiki\" style=\"background-color: #212121\"><code><span class=\"line\"><span style=\"color: #89DDFF\">import</span><span style=\"color: #EEFFFF\"> React </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">import</span><span style=\"color: #EEFFFF\"> ReactDOM </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">react-dom</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">import</span><span style=\"color: #EEFFFF\"> App </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">./App</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #EEFFFF\">ReactDOM</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">render</span><span style=\"color: #EEFFFF\">(</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">App</span><span style=\"color: #89DDFF\"> /&gt;,</span><span style=\"color: #EEFFFF\"> document</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getElementById</span><span style=\"color: #EEFFFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">root</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #EEFFFF\">))</span><span style=\"color: #89DDFF\">;</span></span></code></pre><p>App.js</p>\n<pre class=\"shiki\" style=\"background-color: #212121\"><code><span class=\"line\"><span style=\"color: #89DDFF\">import</span><span style=\"color: #EEFFFF\"> React </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">export</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">default</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C792EA\">function</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #82AAFF\">App</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">return</span><span style=\"color: #F07178\"> (</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">className</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">App</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">h1</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #EEFFFF\">Hello World</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">h1</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    </span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  )</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre><p>index.html</p>\n<pre class=\"shiki\" style=\"background-color: #212121\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;!</span><span style=\"color: #F07178\">DOCTYPE</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">html</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">html</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">lang</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">en</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">head</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">meta</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">charset</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">utf-8</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\"> /&gt;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">meta</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">      </span><span style=\"color: #C792EA\">name</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">viewport</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">      </span><span style=\"color: #C792EA\">content</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">width=device-width, initial-scale=1, shrink-to-fit=no</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    /&gt;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">meta</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">name</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">theme-color</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">content</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">#000000</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\"> /&gt;</span></span>\n\n<span class=\"line\"><span style=\"color: #EEFFFF\">    </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">link</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">rel</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">shortcut icon</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">href</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">%PUBLIC_URL%/favicon.ico</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\"> /&gt;</span></span>\n\n<span class=\"line\"><span style=\"color: #EEFFFF\">    </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">title</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #EEFFFF\">ESP32 React Server</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">title</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">head</span><span style=\"color: #89DDFF\">&gt;</span></span>\n\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">body</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">noscript</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #EEFFFF\"> You need to enable JavaScript to run this app. </span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">noscript</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">id</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">root</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">&gt;&lt;/</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">body</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">html</span><span style=\"color: #89DDFF\">&gt;</span></span></code></pre><h3 id=\"ii-pack-your-bags\">II. Pack Your Bags</h3>\n<p>Now we have a react application, congrats! But it&#39;s pretty useless, we can&#39;t even run it to see what it looks like. Lame! It&#39;s okay, after this headache we should have a working dev environment.</p>\n<p>For this, you&#39;re gonna wanna just copy my shit, webpack is kind of convoluted. If you&#39;re interested read the documentation.</p>\n<p>Install the dependencies with <code>yarn</code>\nRun the dev server with <code>yarn start</code></p>\n<h3 id=\"iii-construction-commences\">III. Construction Commences</h3>\n<ol>\n<li> With webpack working we can install any packages we want! Lets install a color picker with <code>yarn add @uiw/react-color-sketch</code></li>\n<li> And we can add the new component to the react app.</li>\n</ol>\n<pre class=\"shiki\" style=\"background-color: #212121\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">className</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">colorPicker</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">Sketch</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    </span><span style=\"color: #C792EA\">color</span><span style=\"color: #89DDFF\">={</span><span style=\"color: #EEFFFF\">hex</span><span style=\"color: #89DDFF\">}</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    </span><span style=\"color: #C792EA\">onChange</span><span style=\"color: #89DDFF\">={(</span><span style=\"color: #EEFFFF\">color</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #82AAFF\">setHex</span><span style=\"color: #F07178\">(</span><span style=\"color: #EEFFFF\">color</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #EEFFFF\">hex</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">}}</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  /&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span></code></pre><ol start=\"4\">\n<li> Build the app like normal. We can add styles with <code>import &quot;./styles.css&quot;;</code> and even create separate component or utility files. All of this will get bundled at the end of the day.</li>\n</ol>\n<h3 id=\"iv-talking-with-others\">IV. Talking With Others</h3>\n<p>It would be great if the web server could not only be hosted by the ESP32, but could also communicate and send commands!\nUsing the Fetch API, this is fairly straightforward.</p>\n<pre class=\"shiki\" style=\"background-color: #212121\"><code><span class=\"line\"><span style=\"color: #89DDFF\">export</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C792EA\">function</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #82AAFF\">postLed</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #EEFFFF\">hex</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #82AAFF\">fetch</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #C3E88D\">/api/led</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    method</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">POST</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    body</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">parseInt</span><span style=\"color: #F07178\">(</span><span style=\"color: #EEFFFF\">hex</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">substr</span><span style=\"color: #F07178\">(</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">16</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre><p>Here, we keep the POST request as simple as possible (KISS) because processing the body on the ESP32 is not as easy.</p>\n<ol>\n<li> <code>/api/led</code> This will be the api path to implement on the ESP32.</li>\n<li> <code>method: &quot;POST&quot;</code> Since we are sending data we will use a POST request (see HTTP headers for more info).</li>\n<li> <code>parseInt(hex.substr(1), 16)</code> Just some fancy JS to clean up the hex value so that we have as little processing to do on the ESP32 as possible. (Remember the device the front-end is running on is lightyears quicker than the ESP32 is.)</li>\n</ol>\n<h3 id=\"v-build-the-bundle\">V. Build the Bundle</h3>\n<ol>\n<li> Run <code>yarn build</code>. Hopefully no errors pop up! 🤞</li>\n<li>In the <code>app/dist</code> folder you should see a couple files, these are the important ones:<ol>\n<li> <code>favicon.ico</code></li>\n<li> <code>index.html</code></li>\n<li> <code>index.js</code></li>\n</ol>\n</li>\n</ol>\n<p>That&#39;s it! That&#39;s the whole React app! You can actually open <code>index.html</code> in your browser and the app should work just like it did in the development environment. Now, on to the microcontroller!</p>\n<h1 id=\"step-2---size-doesnt-matter\">Step 2 - Size Doesn&#39;t Matter</h1>\n<h3 id=\"i-data-makes-the-world-go-round\">I. Data Makes the World Go Round</h3>\n<p>To set up the arduino project, lets create another folder in the project folder.</p>\n<ol>\n<li> In the project folder, create the folder <code>appserver</code>,</li>\n<li> In this new folder create a file <code>appserver.ino</code></li>\n<li> Also in this new folder, create a folder <code>data/</code>.</li>\n</ol>\n<p>A note on naming: <strong>The folder MUST BE NAMED DATA !!</strong> The folder and the <code>.ino</code> file <em>must</em> have the same names (but it can be whatever your heart desires 💗).</p>\n<ol start=\"4\">\n<li> Copy the important files from the <code>app/dist/</code> folder into the <code>appserver/data/</code> folder.</li>\n<li> In the Arduino IDE, open the <code>appserver/</code> folder.</li>\n<li> Connect your ESP32. Select <em>Tools</em> &gt; <em>Esp32 Sketch Data Uploader</em>, and wait for the data to upload.</li>\n</ol>\n<p>The ESP32 Sketch Data Uploader or ESP32 FS Uploader, uploads all files in the sketch&#39;s data folder into the device&#39;s SPIFFS filesystem. Please note that sub-directories (e.x. <code>/data/newfolder/myfile.txt</code>) are <strong>NOT</strong> supported (unless you are using LittleFS, which we, right now, unfortunately, are not using). If you have any questions please refer to the ESP32 SPIFFS and FS documentation (and let me know if you find any useful information because I found none).</p>\n<h3 id=\"painters-paint-and-coders-sketch\">Painters Paint and Coders... Sketch?</h3>\n<p>Finally! We get to write code for the ESP32! All this time and not a single crumb of C++. Doesn&#39;t it feel good? The wind in your hair, the sun beaming down, and a nice cup of javascript to wash it all down. Well, you better put that cup of joe down, because it&#39;s time to get <em>serious</em> (get it.. like C-erious... like C but it&#39;s.. you know what, nevermind).</p>\n<p>This is another portion where it might be easier just to look at the full code, but I&#39;ll walk through some important parts and sections I found difficult.</p>\n<p><strong><em>WIFIY</em></strong></p>\n<pre class=\"shiki\" style=\"background-color: #212121\"><code><span class=\"line\"><span style=\"color: #EEFFFF\">const char </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #EEFFFF\">ssid = </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">YourSSID</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #EEFFFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">const char </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #EEFFFF\">password = </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Your Password</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #EEFFFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">const bool apMode = false;</span></span>\n\n<span class=\"line\"><span style=\"color: #EEFFFF\">...</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">void</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #82AAFF\">setup</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    ...</span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">//</span><span style=\"color: #EEFFFF\"> ### Start WiFi</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    if </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #EEFFFF\">apMode</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">        ...</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    }</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">}</span></span></code></pre><p>Please enter your network SSID and password up at the top if you want the web server to be available on your network. Otherwise, you can set <code>apMode = true</code> and the ESP32 will create its own wireless network and host the server there.</p>\n<p><strong><em>SPIFFY</em></strong></p>\n<pre class=\"shiki\" style=\"background-color: #212121\"><code><span class=\"line\"><span style=\"color: #89DDFF\">//</span><span style=\"color: #EEFFFF\"> ### Start SPIFFS</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">if </span><span style=\"color: #89DDFF\">(!</span><span style=\"color: #EEFFFF\">SPIFFS</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">begin</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #EEFFFF\">true</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    Serial</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">println</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">SPIFFS Mount Failed</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #EEFFFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    return;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">}</span></span></code></pre><p>This is how I start SPIFFS, and it works for me. 🤷</p>\n<p><strong><em>Asyncy</em></strong></p>\n<pre class=\"shiki\" style=\"background-color: #212121\"><code><span class=\"line\"><span style=\"color: #EEFFFF\">AsyncWebServer </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #EEFFFF\">server;</span></span>\n\n<span class=\"line\"><span style=\"color: #FFCB6B\">void</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #82AAFF\">setup</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    </span><span style=\"color: #89DDFF\">//</span><span style=\"color: #EEFFFF\"> ### Start Server</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    server = new </span><span style=\"color: #82AAFF\">AsyncWebServer</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #EEFFFF\">80</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #EEFFFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    ...</span></span></code></pre><p>Mind the Async server boilerplate. (I did it a little weird because I pulled this code from custom library created for another project)</p>\n<pre class=\"shiki\" style=\"background-color: #212121\"><code><span class=\"line\"><span style=\"color: #89DDFF\">//</span><span style=\"color: #EEFFFF\"> ### Server Routes</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">server</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">on</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #EEFFFF\">, HTTP_GET, </span><span style=\"color: #89DDFF\">[](</span><span style=\"color: #FFCB6B\">AsyncWebServerRequest</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C792EA\">*</span><span style=\"color: #EEFFFF\">request</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">           </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #F07178\"> </span><span style=\"color: #EEFFFF\">request</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">send</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">SPIFFS, </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/index.html</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #F07178\">, </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">text/html</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F07178\">; </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #EEFFFF\">);</span></span>\n\n<span class=\"line\"><span style=\"color: #EEFFFF\">server</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">on</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/index.js</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #EEFFFF\">, HTTP_GET, </span><span style=\"color: #89DDFF\">[](</span><span style=\"color: #FFCB6B\">AsyncWebServerRequest</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C792EA\">*</span><span style=\"color: #EEFFFF\">request</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">           </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #F07178\"> </span><span style=\"color: #EEFFFF\">request</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">send</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">SPIFFS, </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/index.js</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #F07178\">, </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">text/javascript</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F07178\">; </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #EEFFFF\">);</span></span>\n\n<span class=\"line\"><span style=\"color: #EEFFFF\">server</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">on</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/favicon.ico</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #EEFFFF\">, HTTP_GET, </span><span style=\"color: #89DDFF\">[](</span><span style=\"color: #FFCB6B\">AsyncWebServerRequest</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C792EA\">*</span><span style=\"color: #EEFFFF\">request</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">           </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #F07178\"> </span><span style=\"color: #EEFFFF\">request</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">send</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">SPIFFS, </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/favicon.ico</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #F07178\">, </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">image/x-icon</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F07178\">; </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #EEFFFF\">);</span></span></code></pre><p>Lets talk about these server routes. These three routes serve the files necessary for the React application to run. Only the smartest of readers will have noticed that these routes conspicuously correspond to the list of important files we purposely placed into the data folder.</p>\n<pre class=\"shiki\" style=\"background-color: #212121\"><code><span class=\"line\"><span style=\"color: #89DDFF\">//</span><span style=\"color: #EEFFFF\"> ### API</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">server</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">on</span><span style=\"color: #89DDFF\">(</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/api/led</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #EEFFFF\">, HTTP_POST,</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    </span><span style=\"color: #89DDFF\">[](</span><span style=\"color: #FFCB6B\">AsyncWebServerRequest</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C792EA\">*</span><span style=\"color: #EEFFFF\">request</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">{}</span><span style=\"color: #EEFFFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    NULL,</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    </span><span style=\"color: #89DDFF\">[](</span><span style=\"color: #FFCB6B\">AsyncWebServerRequest</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C792EA\">*</span><span style=\"color: #EEFFFF\">request</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #FFCB6B\">uint8_t</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C792EA\">*</span><span style=\"color: #EEFFFF\">data</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #FFCB6B\">size_t</span><span style=\"color: #EEFFFF\"> len</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #FFCB6B\">size_t</span><span style=\"color: #EEFFFF\"> index</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #FFCB6B\">size_t</span><span style=\"color: #EEFFFF\"> total</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">        char </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #EEFFFF\">str = </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #EEFFFF\">char </span><span style=\"color: #89DDFF\">*)</span><span style=\"color: #EEFFFF\">data;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">        Serial</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">println</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">atoi</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #EEFFFF\">str</span><span style=\"color: #89DDFF\">))</span><span style=\"color: #EEFFFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">        pixel</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">setPixelColor</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #EEFFFF\">0, pixel</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">gamma32</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">atoi</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #EEFFFF\">str</span><span style=\"color: #89DDFF\">)))</span><span style=\"color: #EEFFFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">        pixel</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">show</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #EEFFFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #EEFFFF\">        request</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">send</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #EEFFFF\">200</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #EEFFFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    });</span></span></code></pre><p>Now, for the API route. This beast of boilerplate is super simple once the crap is removed.</p>\n<pre class=\"shiki\" style=\"background-color: #212121\"><code><span class=\"line\"><span style=\"color: #EEFFFF\">char </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #EEFFFF\">str = </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #EEFFFF\">char </span><span style=\"color: #89DDFF\">*)</span><span style=\"color: #EEFFFF\">data;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">pixel</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">setPixelColor</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #EEFFFF\">0, pixel</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">gamma32</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">atoi</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #EEFFFF\">str</span><span style=\"color: #89DDFF\">)))</span><span style=\"color: #EEFFFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">pixel</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">show</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #EEFFFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #EEFFFF\">request</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">send</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #EEFFFF\">200</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #EEFFFF\">;</span></span></code></pre><p>Here, extracted from the distractions, is the code that converts the message sent from the server into changing the pixel color. The <code>data</code> variable points to an array of <code>uint8_t</code> values, i.e. the list of chars from the request body. In our case, since we processed everything out in javascript and sent the data over raw and ready to go, we simply cast a few times to convert the char array into the integer values the pixel library wants.</p>\n<p>For the more complex, JSON processing is possible using a library called <a href=\"https://arduinojson.org/\">ArduinoJson</a>, but that is a whole beast in itself.</p>\n<pre class=\"shiki\" style=\"background-color: #212121\"><code><span class=\"line\"><span style=\"color: #EEFFFF\">...</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">    server</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">begin</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #EEFFFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">}</span></span></code></pre><p>Last but not least, don&#39;t forget to start the server.</p>\n<pre class=\"shiki\" style=\"background-color: #212121\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">void</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #82AAFF\">loop</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">}</span></span></code></pre><p>And a blank Loop is required to get Arduino to compile. Nothing needs to happen in the loop since the server runs out of sync (asynchronously).</p>\n<h1 id=\"step-3---its-showtime\">Step 3 - It&#39;s Showtime</h1>\n<p>That&#39;s (hopefully) it! Build and upload the sketch, get the IP address from the Serial monitor, and type that bad boy into your browser of choice! You should (hopefully) now be looking at a fully functional React app hosted on a toaster, woops, I mean ESP32.</p>\n","data":{"slug":"React-JS-and-ESP32-Color-Picker","title":"Hosting a React.JS web application from an ESP 32 using Async server, webpack, and more","date":"2021-9-9","tags":"esp32, reactjs"},"tags":["esp32","reactjs"]}